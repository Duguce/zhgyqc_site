{{ partial "header.html" . }}

{{ $sectionPath := "" }}
{{ with .File }}{{ $sectionPath = .File.Path }}{{ end }}
{{ $isCnBlogs := strings.HasPrefix $sectionPath "cn/blogs" }}
{{ $isEnMoments := strings.HasPrefix $sectionPath "en/moments" }}
{{ $useScholarLayout := or $isCnBlogs $isEnMoments }}

{{ if $useScholarLayout }}
  {{ $entries := .Pages.ByDate.Reverse }}
  {{ $paginator := .Paginate $entries 4 }}
  {{ $totalEntries := len $entries }}
  {{ $yearGroups := .Pages.GroupByDate "2006" }}
  {{ $activeYears := len $yearGroups }}
  {{ $latestStamp := "" }}
  {{ if gt $totalEntries 0 }}
    {{ $latestStamp = (index $entries 0).Date.Format "2006-01-02" }}
  {{ end }}
  {{ $heroDesc := cond $isCnBlogs "Long-form reflections, research logs, and essays collected in one scholarly notebook." "Short dispatches and observational notes that capture daily momentum." }}
  {{ $panelTitle := cond $isCnBlogs "Archive ledger" "Field log" }}
  {{ $panelDesc := cond $isCnBlogs "Browse the latest essays or jump through years using the index below." "Recent dispatches arranged for quick scanning; tap any card to open the full note." }}
  {{ $ctaLabel := cond $isCnBlogs "Read entry" "Open moment" }}
  {{ $stat1Label := cond $isCnBlogs "文章总数" "Total entries" }}
  {{ $stat2Label := cond $isCnBlogs "活跃年份" "Active years" }}
  {{ $stat3Label := cond $isCnBlogs "最近更新" "Last update" }}
  {{ $badgeLabel := cond $isCnBlogs "Writing Ledger" "Live Log" }}
  <main class="content" role="main">
    <style>
    /* Scholarly list layout */
    .scholar-shell {
      --shell-surface: #f6f4ef;
      --shell-border: #d7d2c6;
      --shell-ink: #1f2535;
      --shell-muted: #5c6272;
      --shell-accent: #8a6f4d;
      --shell-highlight: #d8cfbe;
      font-family: "Source Serif Pro", "Palatino Linotype", Georgia, serif;
      color: var(--shell-ink);
      padding-bottom: 3.2rem;
    }
    .scholar-shell[data-variant="moments"] {
      --shell-surface: #f1f6fb;
      --shell-border: #d0dfea;
      --shell-accent: #4b6fad;
      --shell-highlight: #d8e4f2;
    }
    .scholar-hero {
      background: var(--shell-surface);
      border: 1px solid var(--shell-border);
      border-radius: 1.3rem;
      padding: 1.6rem;
      margin: 0 auto 1.6rem;
      max-width: 960px;
      position: relative;
      overflow: hidden;
    }
    .scholar-hero::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 20% 15%, rgba(138, 111, 77, 0.22), transparent 50%),
                  linear-gradient(120deg, rgba(31, 37, 53, 0.08), transparent 65%);
      opacity: 0.45;
      pointer-events: none;
    }
    .scholar-shell[data-variant="moments"] .scholar-hero::after {
      background: radial-gradient(circle at 15% 20%, rgba(75, 111, 173, 0.26), transparent 55%),
                  linear-gradient(130deg, rgba(34, 52, 86, 0.08), transparent 60%);
    }
    .scholar-hero__body {
      position: relative;
      z-index: 1;
    }
    .scholar-hero__badge {
      font-size: 0.8rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--shell-muted);
      margin-bottom: 0.45rem;
      display: inline-block;
    }
    .scholar-hero h1 {
      font-size: clamp(1.95rem, 3vw, 2.6rem);
      margin-bottom: 0.4rem;
    }
    .scholar-hero__desc {
      max-width: 700px;
      font-size: 0.98rem;
      line-height: 1.45;
      color: var(--shell-muted);
      margin-bottom: 0.8rem;
    }
    .scholar-hero__rich {
      max-width: 700px;
      color: var(--shell-ink);
      font-size: 0.95rem;
      line-height: 1.55;
      margin-bottom: 0.9rem;
    }
    .scholar-hero__stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
      gap: 0.8rem;
      margin-top: 0.9rem;
    }
    .stat-card {
      background: #fff;
      border: 1px solid var(--shell-border);
      border-radius: 0.95rem;
      padding: 0.85rem 1.1rem;
      box-shadow: 0 12px 32px rgba(27, 33, 45, 0.08);
    }
    .stat-card__label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--shell-muted);
      margin-bottom: 0.2rem;
      display: block;
    }
    .stat-card__value {
      font-size: 1.4rem;
      font-weight: 600;
    }
    .scholar-panel {
      border: 1px solid var(--shell-border);
      border-radius: 1.3rem;
      padding: 1.8rem;
      background: #fff;
      box-shadow: 0 18px 40px rgba(14, 19, 29, 0.08);
    }
    .scholar-panel__header {
      text-align: center;
      margin-bottom: 1.6rem;
    }
    .scholar-panel__header h2 {
      font-size: 1.25rem;
      margin-bottom: 0.35rem;
    }
    .scholar-panel__header p {
      color: var(--shell-muted);
      font-size: 0.95rem;
      max-width: 520px;
      margin: 0 auto;
    }
    .entry-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
    }
    .entry-card {
      border: 1px solid var(--shell-border);
      border-radius: 1rem;
      padding: 1rem 1.1rem;
      background: #fefdfb;
      position: relative;
      overflow: hidden;
      min-height: 185px;
      display: flex;
      flex-direction: column;
      gap: 0.45rem;
      transition: transform 160ms ease, box-shadow 160ms ease;
    }
    .entry-card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(125deg, rgba(138, 111, 77, 0.2), rgba(255, 255, 255, 0));
      opacity: 0.18;
      pointer-events: none;
    }
    .scholar-shell[data-variant="moments"] .entry-card::before {
      background: linear-gradient(120deg, rgba(75, 111, 173, 0.22), rgba(255, 255, 255, 0));
    }
    .entry-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 20px 36px rgba(20, 24, 35, 0.16);
    }
    .entry-card__meta {
      font-size: 0.8rem;
      color: var(--shell-muted);
      display: flex;
      gap: 0.4rem;
      flex-wrap: wrap;
      position: relative;
      z-index: 1;
    }
    .entry-card h3 {
      margin: 0;
      font-size: 1.05rem;
      position: relative;
      z-index: 1;
    }
    .entry-card h3 a {
      color: inherit;
      text-decoration: none;
    }
    .entry-card h3 a:hover {
      text-decoration: underline;
    }
    .entry-card p {
      margin: 0;
      color: var(--shell-muted);
      font-size: 0.88rem;
      line-height: 1.4;
      position: relative;
      z-index: 1;
    }
    .entry-card__footer {
      margin-top: auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.82rem;
      position: relative;
      z-index: 1;
    }
    .entry-card__link {
      text-decoration: none;
      color: var(--shell-accent);
      font-weight: 600;
      font-size: 0.82rem;
      display: inline-flex;
      align-items: center;
      gap: 0.2rem;
    }
    .entry-card__link::after {
      content: "->";
      font-size: 0.85rem;
      transition: transform 150ms ease;
    }
    .entry-card__link:hover::after {
      transform: translateX(3px);
    }
    .entry-empty {
      text-align: center;
      color: var(--shell-muted);
      font-size: 0.95rem;
      margin: 2rem 0 0;
    }
    .scholar-pagination {
      margin: 1.6rem auto 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
      padding: 0.45rem 0.8rem;
      border: 1px solid var(--shell-border);
      border-radius: 999px;
      background: #fff;
      box-shadow: 0 14px 32px rgba(16, 22, 32, 0.08);
    }
    .scholar-pagination__button {
      border: 1px solid transparent;
      border-radius: 999px;
      padding: 0.3rem 0.85rem;
      font-size: 0.8rem;
      color: var(--shell-muted);
      text-decoration: none;
      min-width: 2.4rem;
      text-align: center;
      transition: background 140ms ease, color 140ms ease, border-color 140ms ease;
    }
    .scholar-pagination__button.is-active {
      background: var(--shell-surface);
      color: var(--shell-accent);
      border-color: var(--shell-highlight);
      font-weight: 600;
    }
    .scholar-pagination__button:hover {
      color: var(--shell-accent);
    }
    .scholar-pagination__button.is-disabled {
      pointer-events: none;
      opacity: 0.35;
    }
    @media (max-width: 720px) {
      .scholar-panel {
        padding: 1.4rem;
      }
      .entry-grid {
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      }
    }
    </style>
    <div class="scholar-shell" data-variant="{{ if $isCnBlogs }}blogs{{ else }}moments{{ end }}">
      <section class="scholar-hero" aria-labelledby="scholar-hero-title">
        <div class="scholar-hero__body">
          <div class="scholar-hero__badge">{{ $badgeLabel }}</div>
          {{/* Removed explicit H1 to keep focus on secondary header */}}
          <p class="scholar-hero__desc">{{ $heroDesc }}</p>
          {{ with .Content }}
          <div class="scholar-hero__rich">{{ . }}</div>
          {{ end }}
          <div class="scholar-hero__stats">
            <div class="stat-card">
              <span class="stat-card__label">{{ $stat1Label }}</span>
              <span class="stat-card__value">{{ $totalEntries }}</span>
            </div>
            <div class="stat-card">
              <span class="stat-card__label">{{ $stat2Label }}</span>
              <span class="stat-card__value">{{ $activeYears }}</span>
            </div>
            <div class="stat-card">
              <span class="stat-card__label">{{ $stat3Label }}</span>
              <span class="stat-card__value">{{ if $latestStamp }}{{ $latestStamp }}{{ else }}&mdash;{{ end }}</span>
            </div>
          </div>
        </div>
      </section>
      <section class="scholar-panel" aria-labelledby="scholar-panel-title">
        <div class="scholar-panel__header" id="scholar-panel-title">
          <h2>{{ $panelTitle }}</h2>
          <p>{{ $panelDesc }}</p>
        </div>
        {{ if gt $totalEntries 0 }}
        <div class="entry-grid" role="list">
          {{ range $paginator.Pages }}
          {{ $cardScratch := newScratch }}
          {{ if .Params.summary }}
            {{ $cardScratch.Set "summary" .Params.summary }}
          {{ else if .Description }}
            {{ $cardScratch.Set "summary" .Description }}
          {{ else if .Summary }}
            {{ $cardScratch.Set "summary" (.Summary | plainify) }}
          {{ else }}
            {{ $cardScratch.Set "summary" (.Plain | plainify) }}
          {{ end }}
          {{ $summary := truncate 150 ($cardScratch.Get "summary") }}
          <article class="entry-card" role="listitem">
            <div class="entry-card__meta">
              <span>{{ .Date.Format "Jan 02, 2006" }}</span>
              {{ with .Params.location }}<span>&middot; {{ . }}</span>{{ end }}
            </div>
            <h3><a href="{{ .RelPermalink }}">{{ .Title }}</a></h3>
            <p>{{ $summary }}</p>
            <div class="entry-card__footer">
              <span class="entry-card__year">{{ .Date.Format "2006" }}</span>
              <a href="{{ .RelPermalink }}" class="entry-card__link">{{ $ctaLabel }}</a>
            </div>
          </article>
          {{ end }}
        </div>
        {{ if gt $paginator.TotalPages 1 }}
        <nav class="scholar-pagination" aria-label="Pagination">
          <a class="scholar-pagination__button {{ if not $paginator.HasNext }}is-disabled{{ end }}" href="{{ if $paginator.HasNext }}{{ $paginator.Next.URL }}{{ else }}#{{ end }}">Prev</a>
          {{ range $page := seq 1 $paginator.TotalPages }}
            {{ $pageURL := (index $paginator.Pagers (sub $page 1)).URL }}
            <a class="scholar-pagination__button {{ if eq $page $paginator.PageNumber }}is-active{{ end }}" href="{{ $pageURL }}">{{ $page }}</a>
          {{ end }}
          <a class="scholar-pagination__button {{ if not $paginator.HasPrev }}is-disabled{{ end }}" href="{{ if $paginator.HasPrev }}{{ $paginator.Prev.URL }}{{ else }}#{{ end }}">Next</a>
        </nav>
        {{ end }}
        {{ else }}
        <p class="entry-empty">{{ if $isCnBlogs }}暂无文章{{ else }}No moments published yet.{{ end }}</p>
        {{ end }}
      </section>
    </div>
  </main>
{{ else }}
  {{ $name := .Data.Plural -}}
  {{ if eq $name "tags" -}}
  <h1>{{ .Title | markdownify }}</h1>
  {{ end }}

  <main class = "content">
  <div class="list-page">
  {{ .Content }}

  {{if not .IsHome}}
  <ul>
    {{ range .Pages.GroupByDate "2006" }}
    <h2 style="text-align: left;">{{ .Key }}</h2>
    {{ range .Pages.GroupByDate "2006-01-02" }}
    {{ range .Pages }}
    <p>
      <span class="date">
      {{ .Date.Format "2006-01-02" }}
      </span>
      <a href="{{ .RelPermalink }}">
      {{ .Title }}
      </a>
    </p>
    {{ end }}
    {{ end }}
    {{ end }}
  </ul>
  {{ end }}
  </div>
  </main>
{{ end }}

{{ partial "footer.html" . }}
